<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In - Healthy Eating Pro</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }

    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .gradient-text {
      background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-40px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(40px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      33% {
        transform: translateY(-20px) rotate(5deg);
      }
      66% {
        transform: translateY(-10px) rotate(-5deg);
      }
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 30px rgba(16, 185, 129, 0.4);
      }
      50% {
        box-shadow: 0 0 60px rgba(16, 185, 129, 0.7);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }

    @keyframes gradient-shift {
      0%, 100% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.8s ease-out forwards;
    }

    .animate-slide-in-left {
      animation: slideInLeft 0.8s ease-out forwards;
    }

    .animate-slide-in-right {
      animation: slideInRight 0.8s ease-out forwards;
    }

    .animate-scale-in {
      animation: scaleIn 0.6s ease-out forwards;
    }

    .animate-float {
      animation: float 6s ease-in-out infinite;
    }

    .animate-pulse-glow {
      animation: pulse-glow 3s ease-in-out infinite;
    }

    .animate-shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }

    .gradient-animated {
      background-size: 200% 200%;
      animation: gradient-shift 8s ease infinite;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .input-glow:focus {
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
      outline: none;
    }

    .btn-hover {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn-hover::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-hover:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .floating-shape {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.3;
      pointer-events: none;
    }

    .success-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      display: none;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      animation: slideInRight 0.4s ease-out;
    }

    .success-toast.show {
      display: flex;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app-wrapper" class="h-full w-full overflow-auto"><!-- Floating background shapes -->
   <div class="floating-shape animate-float" style="top: 10%; left: 10%; width: 300px; height: 300px; animation-delay: 0s;"></div>
   <div class="floating-shape animate-float" style="top: 60%; right: 15%; width: 250px; height: 250px; animation-delay: 2s;"></div>
   <div class="floating-shape animate-float" style="bottom: 10%; left: 40%; width: 200px; height: 200px; animation-delay: 4s;"></div><!-- Success Toast -->
   <div id="success-toast" class="success-toast"><span class="text-3xl">âœ…</span>
    <div>
     <p class="font-semibold" id="toast-title">Success!</p>
     <p class="text-sm opacity-80" id="toast-message">Action completed successfully</p>
    </div>
   </div>
   <main class="h-full flex items-center justify-center px-6 py-12 relative"><!-- Login View -->
    <div id="login-view" class="w-full max-w-md">
     <div class="text-center mb-8 animate-fade-in-up">
      <div class="inline-flex items-center justify-center w-20 h-20 rounded-3xl mb-6 text-5xl animate-float">
       ðŸ¥—
      </div>
      <h1 id="app-title" class="text-4xl font-extrabold mb-3 gradient-text"></h1>
      <p id="app-tagline" class="text-lg opacity-80"></p>
     </div>
     <div class="glass-effect rounded-3xl p-8 animate-scale-in shadow-2xl" style="animation-delay: 0.2s;">
      <h2 id="login-heading" class="text-3xl font-bold mb-2"></h2>
      <p id="login-subheading" class="opacity-70 mb-8"></p><!-- Google Sign In --> <button id="google-login-btn" class="w-full btn-hover rounded-xl py-4 font-semibold mb-4 flex items-center justify-center gap-3 relative z-10">
       <svg class="w-6 h-6" viewbox="0 0 24 24"><path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /> <path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /> <path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
       </svg><span id="google-button-text"></span> </button>
      <div class="flex items-center gap-4 my-6">
       <div class="flex-1 h-px opacity-20"></div><span class="text-sm opacity-50 font-medium">OR</span>
       <div class="flex-1 h-px opacity-20"></div>
      </div><!-- Email Login Form -->
      <form id="email-login-form" class="space-y-4">
       <div><label for="login-email" class="block text-sm font-semibold mb-2">Email Address</label> <input type="email" id="login-email" required class="w-full px-4 py-3 rounded-xl input-glow transition-all duration-300" placeholder="your@email.com">
       </div>
       <div><label for="login-password" class="block text-sm font-semibold mb-2">Password</label> <input type="password" id="login-password" required class="w-full px-4 py-3 rounded-xl input-glow transition-all duration-300" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
       </div><button type="submit" id="email-login-btn" class="w-full btn-hover rounded-xl py-4 font-bold text-lg relative z-10 animate-pulse-glow"> <span id="email-button-text"></span> </button>
      </form>
      <div class="text-center mt-6"><button id="switch-to-signup" class="text-sm font-medium opacity-70 hover:opacity-100 transition-opacity duration-300"></button>
      </div>
     </div>
    </div><!-- Signup View -->
    <div id="signup-view" class="w-full max-w-md hidden">
     <div class="text-center mb-8 animate-fade-in-up">
      <div class="inline-flex items-center justify-center w-20 h-20 rounded-3xl mb-6 text-5xl animate-float">
       ðŸ¥—
      </div>
      <h1 id="app-title-signup" class="text-4xl font-extrabold mb-3 gradient-text"></h1>
      <p id="app-tagline-signup" class="text-lg opacity-80"></p>
     </div>
     <div class="glass-effect rounded-3xl p-8 animate-scale-in shadow-2xl" style="animation-delay: 0.2s;">
      <h2 id="signup-heading" class="text-3xl font-bold mb-2"></h2>
      <p id="signup-subheading" class="opacity-70 mb-8"></p><!-- Google Sign Up --> <button id="google-signup-btn" class="w-full btn-hover rounded-xl py-4 font-semibold mb-4 flex items-center justify-center gap-3 relative z-10">
       <svg class="w-6 h-6" viewbox="0 0 24 24"><path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /> <path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /> <path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
       </svg><span id="google-signup-button-text"></span> </button>
      <div class="flex items-center gap-4 my-6">
       <div class="flex-1 h-px opacity-20"></div><span class="text-sm opacity-50 font-medium">OR</span>
       <div class="flex-1 h-px opacity-20"></div>
      </div><!-- Email Signup Form -->
      <form id="email-signup-form" class="space-y-4">
       <div><label for="signup-name" class="block text-sm font-semibold mb-2">Full Name</label> <input type="text" id="signup-name" required class="w-full px-4 py-3 rounded-xl input-glow transition-all duration-300" placeholder="John Doe">
       </div>
       <div><label for="signup-email" class="block text-sm font-semibold mb-2">Email Address</label> <input type="email" id="signup-email" required class="w-full px-4 py-3 rounded-xl input-glow transition-all duration-300" placeholder="your@email.com">
       </div>
       <div><label for="signup-password" class="block text-sm font-semibold mb-2">Password</label> <input type="password" id="signup-password" required minlength="6" class="w-full px-4 py-3 rounded-xl input-glow transition-all duration-300" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
       </div><button type="submit" id="signup-submit-btn" class="w-full btn-hover rounded-xl py-4 font-bold text-lg relative z-10 animate-pulse-glow"> <span id="signup-button-text"></span> </button>
      </form>
      <div class="text-center mt-6"><button id="switch-to-login" class="text-sm font-medium opacity-70 hover:opacity-100 transition-opacity duration-300"></button>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
    const TOKEN_KEY = 'yahealthy_token';
    const defaultConfig = {
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#f1f5f9',
      primary_action_color: '#10b981',
      secondary_action_color: '#3b82f6',
      font_family: 'Inter',
      font_size: 16,
      app_title: 'Healthy Eating Pro',
      app_tagline: 'Your journey to better health starts here',
      login_heading: 'Welcome Back',
      login_subheading: 'Sign in to continue your wellness journey',
      signup_heading: 'Join Us Today',
      signup_subheading: 'Start your transformation journey',
      google_button_text: 'Continue with Google',
      email_button_text: 'Sign in with Email',
      signup_button_text: 'Create Account',
      switch_to_signup: "Don't have an account? Sign up",
      switch_to_login: 'Already have an account? Sign in'
    };

    let config = { ...defaultConfig };
    let isLoading = false;

    function setToken(token) {
      localStorage.setItem(TOKEN_KEY, token);
    }

    function getToken() {
      return localStorage.getItem(TOKEN_KEY);
    }

    function clearToken() {
      localStorage.removeItem(TOKEN_KEY);
    }

    async function apiRequest(path, options = {}) {
      const headers = { ...(options.headers || {}) };
      headers['Content-Type'] = headers['Content-Type'] || 'application/json';
      const res = await fetch(path, { ...options, headers });
      const text = await res.text();
      let json = null;
      try { json = text ? JSON.parse(text) : null; } catch { json = null; }

      if (!res.ok) {
        const message = (json && (json.error || json.message)) || `Request failed (${res.status})`;
        throw new Error(message);
      }

      return json;
    }

    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'Inter, -apple-system, BlinkMacSystemFont, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color}, ${config.surface_color || defaultConfig.surface_color})`;
      document.body.style.color = config.text_color || defaultConfig.text_color;
      
      const floatingShapes = document.querySelectorAll('.floating-shape');
      floatingShapes.forEach((shape, i) => {
        if (i === 0) shape.style.background = config.primary_action_color || defaultConfig.primary_action_color;
        if (i === 1) shape.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
        if (i === 2) shape.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      });
      
      const glassCards = document.querySelectorAll('.glass-effect');
      glassCards.forEach(card => {
        card.style.background = `rgba(${hexToRgb(config.surface_color || defaultConfig.surface_color)}, 0.4)`;
        card.style.borderColor = `rgba(${hexToRgb(config.text_color || defaultConfig.text_color)}, 0.15)`;
      });
      
      const inputs = document.querySelectorAll('input');
      inputs.forEach(input => {
        input.style.background = `rgba(${hexToRgb(config.surface_color || defaultConfig.surface_color)}, 0.6)`;
        input.style.color = config.text_color || defaultConfig.text_color;
        input.style.borderColor = `rgba(${hexToRgb(config.text_color || defaultConfig.text_color)}, 0.2)`;
      });
      
      const googleButtons = document.querySelectorAll('#google-login-btn, #google-signup-btn');
      googleButtons.forEach(btn => {
        btn.style.background = config.surface_color || defaultConfig.surface_color;
        btn.style.color = config.text_color || defaultConfig.text_color;
        btn.style.border = `2px solid rgba(${hexToRgb(config.text_color || defaultConfig.text_color)}, 0.3)`;
      });
      
      const primaryButtons = document.querySelectorAll('#email-login-btn, #signup-submit-btn');
      primaryButtons.forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color})`;
        btn.style.color = config.background_color || defaultConfig.background_color;
      });
      
      const switchButtons = document.querySelectorAll('#switch-to-signup, #switch-to-login');
      switchButtons.forEach(btn => {
        btn.style.color = config.text_color || defaultConfig.text_color;
      });
      
      const emoji = document.querySelectorAll('.animate-float')[0];
      if (emoji) {
        emoji.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color})`;
      }
      
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('app-title-signup').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('app-tagline').textContent = config.app_tagline || defaultConfig.app_tagline;
      document.getElementById('app-tagline-signup').textContent = config.app_tagline || defaultConfig.app_tagline;
      
      document.getElementById('login-heading').textContent = config.login_heading || defaultConfig.login_heading;
      document.getElementById('login-subheading').textContent = config.login_subheading || defaultConfig.login_subheading;
      document.getElementById('signup-heading').textContent = config.signup_heading || defaultConfig.signup_heading;
      document.getElementById('signup-subheading').textContent = config.signup_subheading || defaultConfig.signup_subheading;
      
      document.getElementById('google-button-text').textContent = config.google_button_text || defaultConfig.google_button_text;
      document.getElementById('google-signup-button-text').textContent = config.google_button_text || defaultConfig.google_button_text;
      document.getElementById('email-button-text').textContent = config.email_button_text || defaultConfig.email_button_text;
      document.getElementById('signup-button-text').textContent = config.signup_button_text || defaultConfig.signup_button_text;
      document.getElementById('switch-to-signup').textContent = config.switch_to_signup || defaultConfig.switch_to_signup;
      document.getElementById('switch-to-login').textContent = config.switch_to_login || defaultConfig.switch_to_login;
      
      const gradientTexts = document.querySelectorAll('.gradient-text');
      gradientTexts.forEach(el => {
        el.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color})`;
        el.style.webkitBackgroundClip = 'text';
        el.style.webkitTextFillColor = 'transparent';
      });
      
      const h1Elements = document.querySelectorAll('h1');
      h1Elements.forEach(h => h.style.fontSize = `${baseSize * 2.25}px`);
      
      const h2Elements = document.querySelectorAll('h2');
      h2Elements.forEach(h => h.style.fontSize = `${baseSize * 1.875}px`);
      
      const paragraphs = document.querySelectorAll('p');
      paragraphs.forEach(p => p.style.fontSize = `${baseSize}px`);
      
      const labels = document.querySelectorAll('label');
      labels.forEach(l => l.style.fontSize = `${baseSize * 0.875}px`);
      
      const buttons = document.querySelectorAll('button');
      buttons.forEach(b => b.style.fontSize = `${baseSize}px`);
    }

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '255, 255, 255';
    }

    function showToast(title, message, duration = 3000) {
      const toast = document.getElementById('success-toast');
      const toastBg = config.primary_action_color || defaultConfig.primary_action_color;
      const toastText = config.background_color || defaultConfig.background_color;
      
      toast.style.background = toastBg;
      toast.style.color = toastText;
      
      document.getElementById('toast-title').textContent = title;
      document.getElementById('toast-message').textContent = message;
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    async function handleGoogleLogin() {
      if (isLoading) return;
      isLoading = true;
      
      const btn = document.getElementById('google-login-btn');
      btn.style.opacity = '0.6';
      btn.style.pointerEvents = 'none';
      
      setTimeout(() => {
        showToast('Not Available', 'Google login is not enabled yet. Please use Email.');
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
        isLoading = false;
      }, 600);
    }

    async function handleEmailLogin(e) {
      e.preventDefault();
      if (isLoading) return;
      isLoading = true;
      
      const btn = document.getElementById('email-login-btn');
      const originalText = btn.querySelector('span').textContent;
      btn.querySelector('span').textContent = 'Signing in...';
      btn.style.opacity = '0.6';
      btn.style.pointerEvents = 'none';
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      try {
        const result = await apiRequest('/api/auth/login', {
          method: 'POST',
          body: JSON.stringify({ email, password })
        });
        setToken(result.token);
        showToast('Welcome Back!', `Signed in as ${result.name || result.email}`);
        window.location.href = '/dashboard';
      } catch (err) {
        showToast('Sign in failed', err?.message || 'Invalid email or password');
      } finally {
        btn.querySelector('span').textContent = originalText;
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
        isLoading = false;
      }
    }

    async function handleEmailSignup(e) {
      e.preventDefault();
      if (isLoading) return;
      
      isLoading = true;
      
      const btn = document.getElementById('signup-submit-btn');
      const originalText = btn.querySelector('span').textContent;
      btn.querySelector('span').textContent = 'Creating account...';
      btn.style.opacity = '0.6';
      btn.style.pointerEvents = 'none';
      
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;

      try {
        const result = await apiRequest('/api/auth/signup', {
          method: 'POST',
          body: JSON.stringify({ name, email, password })
        });
        setToken(result.token);
        showToast('Account Created!', `Welcome ${result.name || name}!`);
        document.getElementById('email-signup-form').reset();
        window.location.href = '/dashboard';
      } catch (err) {
        const message = err?.message || 'Failed to create account. Please try again.';
        showToast('Sign up failed', message);
      } finally {
        btn.querySelector('span').textContent = originalText;
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
        isLoading = false;
      }
    }

    function switchView(viewName) {
      document.getElementById('login-view').classList.toggle('hidden', viewName !== 'login');
      document.getElementById('signup-view').classList.toggle('hidden', viewName !== 'signup');
    }

    document.getElementById('google-login-btn').addEventListener('click', handleGoogleLogin);
    document.getElementById('google-signup-btn').addEventListener('click', handleGoogleLogin);
    document.getElementById('email-login-form').addEventListener('submit', handleEmailLogin);
    document.getElementById('email-signup-form').addEventListener('submit', handleEmailSignup);
    document.getElementById('switch-to-signup').addEventListener('click', () => switchView('signup'));
    document.getElementById('switch-to-login').addEventListener('click', () => switchView('login'));

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ surface_color: value });
              }
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['app_tagline', config.app_tagline || defaultConfig.app_tagline],
        ['login_heading', config.login_heading || defaultConfig.login_heading],
        ['login_subheading', config.login_subheading || defaultConfig.login_subheading],
        ['signup_heading', config.signup_heading || defaultConfig.signup_heading],
        ['signup_subheading', config.signup_subheading || defaultConfig.signup_subheading],
        ['google_button_text', config.google_button_text || defaultConfig.google_button_text],
        ['email_button_text', config.email_button_text || defaultConfig.email_button_text],
        ['signup_button_text', config.signup_button_text || defaultConfig.signup_button_text],
        ['switch_to_signup', config.switch_to_signup || defaultConfig.switch_to_signup],
        ['switch_to_login', config.switch_to_login || defaultConfig.switch_to_login]
      ]);
    }

    async function init() {
      // If already authenticated, skip login.
      if (getToken()) {
        window.location.href = '/dashboard';
        return;
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
      
      await onConfigChange(config);
    }

    init();
  </script>
 </body>
</html>
